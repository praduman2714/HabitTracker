<script src="https://kit.fontawesome.com/6866a8ccc0.js" crossorigin="anonymous"></script>

<% if(locals.user) {%>
    <body>
    
        <div class="qutos">
            <h1>“Successful people have successful habits”</h1>
            <p>Start with a new habit today !</p>
        </div>
        
        <div id="input">
            <form action="/users/habit/createHabit" method="POST" class="input-form">
                <input name="habit" type="text" placeholder="Enter your habit..." required>
                <button type="submit" id="form-btn">+ Add Habits</button>
            </form>
        </div>
        
        <div id="symbol">
            <i class="fas fa-check-circle"></i>
           -Done&emsp;&emsp;
           <i class="fas fa-times-circle"></i>
           -Not Done&emsp;&emsp;
           <i class="fas fa-minus-circle"></i>
           -Unmarked&emsp;&emsp;
           <button id="weekly-view__btn-2" onclick="showDailyData()">Daily</button>
           <button id="weekly-view__btn" onclick="showWeeklyData()">weekly</button>
        </div>


         <div class="habit-display_width">
            <ul class="habit-list">
                <li class="with-weekly">
                   
                    <% for(let habit of habits) {%>
                        <div class="habit-list-item">

                            <%let currentDate = new Date();
                            let dd = currentDate.getDate();
                            let mm = currentDate.getMonth() + 1;
                            const yyyy = currentDate.getFullYear();
                            if (dd < 10) dd = '0' + dd;
                            if (mm < 10) mm = '0' + mm;
                            let today = dd + '/' + mm + '/' + yyyy;
                            let found;
                            let status;
                            habit.dates.find((item) => {
                                            if(item.date === today)
                                            {
                                                found = true;
                                                status = item.complete;
                                            }
                                        });
                            %>
                    
                            <a href="/users/habit/toggleStatus/?id=<%= habit._id%>&date=<%= today %>" class="status">
                                <!-- <i class="fas fa-check-circle"></i> -->

                                <% if(found && status==='yes'){ %>
                                    <i class="fas fa-check-circle"></i>
                                    <% } else if(found && status==='no'){ %>
                                    <i class="fas fa-times-circle"></i>
                                    <% } else { %>
                                    <i class="fas fa-minus-circle"></i>
                                    <% } %>
                                
                            </a>
    
                            <div class="habit-list-item-name"> <%=habit.content%> </div>
    
                            <div >
                                <a href="/users/habit/favorite/?id=<%= habit._id%>" class="favorite">
                                    
                                    <% if(habit.favorite) {%>
                                        <i class="fa-solid fa-star"></i>
                                    <%} else {%>
                                        <i class="fa-regular fa-star"></i>
                                    <%}%>      
                                    
                                </a>
                                <a href="/users/habit/remove/?id=<%= habit._id %>" class="remove">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </div>
    
                       </div>
                       <!-- this is the list of dates -->
                       <div class="weekly__container">
                            <% for(let d of weeklyDates){ %>
                                <div class="weekly__date">
                                    <p> <%= d%> </p>

                                    <% 
                                        let find;
                                        let stat;
                                        habit.dates.find((item) => {
                                            if(item.date === d)
                                            {
                                                find = true;
                                                stat = item.complete;
                                            }
                                        });
                                    %>

                                    <a href="/users/habit/toggleStatus/?id=<%= habit._id%>&date=<%=d%>" class="status">
                                        <!-- <i class="fas fa-minus-circle"></i> -->
                                        <% if(find && stat==='yes'){ %>
                                                <i class="fas fa-check-circle"></i>
                                            <% } else if(find && stat==='no'){ %>
                                                <i class="fas fa-times-circle"></i>
                                            <% } else { %>
                                                <i class="fas fa-minus-circle"></i>
                                        <% } %>
                                    </a>
                                </div>
                            <%}%>    
                        
                        </div>

                    <%}%>


                </li>
            </ul>
         </div>
    
    </body>
<%}%>





 <script src="/js/script.js"></script>